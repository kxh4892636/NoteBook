---
id: 22cfd7e6-544c-4999-beff-19d68afdfe4e
---

# 性能优化

## 通用方法

### 服务器响应缓慢

- CDN;
- 本地缓存;
- 使用 `rel-"preconnect"` 告知浏览器尽快建立连接;
  ```htm
  <link rel="preconnect" href="https://example.com" />
  ```

### js/css

- css;
  - 减少 css 文件体积;
  - 使用 preload 和 onload 延迟加载 css;
  ```htm
  <link
    rel="preload"
    href="stylesheet.css"
    as="style"
    onload="this.rel='stylesheet'"
  />
  ```
  - 内联 css;
- js;
  - 压缩 js 文件;
  - 使用 async 和 defer 异步/延迟记载 js;

### 资源加载

- 优化/压缩图像;
- 使用 CDN;
- 使用 gzip 压缩文本;
- 客户端渲染;
  - 使用 ssr;
  - 优化 js/css;
  - 预渲染;
    - 基于无头浏览器预先构建路由的静态 HTML;
    - 减少客户端解析 HTML 时间;

### 工程化

- 打包;
  - 最小化;
  - 混淆;
  - 分块;
- 路由, 组件, 长页面使用懒加载;
- 减少重定向;

## 优化指标

### FCP

##### FCP

- 浏览器呈现第一个 DOM 需要的时间;

##### 优化手段

- 缩短字体加载时间;

### SI

##### SI

- 页面加载期间, 视觉显示的速度;

##### 优化手段

- 减少主进程/线程工作;
- 减少 js 执行时间;

### LCP

##### LCP

- 视口中最大内容元素显示的时间;

##### 造成原因

- 服务器响应缓慢;
- js/css 堵塞;
- 资源加载缓慢;
- 客户端渲染;

### TTI

- 页面变成完全可交互, 需要的时间;

### TBT

- 页面堵塞用户输入的总时间: FCP + TTI;

### CLS

##### CLS

- 累计布局偏移;

##### 造成原因

- 无尺寸的图片;
- 无尺寸的 iframe;
- 动态注入的内容;

### RAIL

- Response Time: 用户交互的响应时间, 要求小于 100ms;
- Animation: 动画在 16ms 内绘制完成;
- Idle: 页面在没有用户输入和事件触发时的时间, 尽量短;
- Load: 页面加载时间, 尽量短;

## SPA/SSR

### SPA

##### 优化方式

- 减少入口文件体积;
- 静态资源本地缓存;
- UI 按需加载;
- 静态文件压缩;
- 重复元素组件化;
- 开启 gzip;
- 使用 ssr;

### SSR

##### SSR

- 页面在服务器进行渲染;

##### 优缺点

- 优点;
  - 首屏加载速度快: 服务器预先生成 HTML, 客户端在收到响应之前即可显示部分页面;
  - 支持 SEO;
  - 用户体验好: 首屏加载速度快;
- 缺点;
  - 服务器压力大;
  - 开发成本高: 额外的服务器页面模板, 数据获取流程;

##### 简要流程

- 配置服务器环境: 客户端搭建 node 环境;
- 应用服务器: 监听 HTTP 请求, 返回 HTML 文本;
- 路由: 根据不同路径返回对应 HTML;
- 客户端脚本: HTML 插入客户端脚本, 用于交互和数据获取;
- SEO 优化: 添加 `<meta\>` 标签;

## 性能分析

### 性能分析工具

##### 浏览器开发者工具

- NetWork 面板;
- Performance 面板;
- Lighthouse 面板;

##### Web 性能优化工具

- WebPage Test;
