---
id: 7e736772-2607-4572-a8d2-06deb6920806
---

# node 基础

## 基本概念

### 单线程

##### 主线程

- js 负责解释和执行代码的线程只有一个,
- 称为主线程;

##### 工作线程

- 浏览器或 node 存在其他线程;
- 处理 http, dom, IO 等;
- 统称为工作线程;

##### 意义

- js 使用单线程不必解决线程同步的问题;

### 同步和异步

##### 同步任务

- 在主线程排队执行的任务;
- 前一个任务结束才会执行下一个任务;

##### 异步任务

- 不进入主线程, 进入任务队列;
- 异步任务返回返回结果后, 在任务队列中顺序放置一个事件;
- 在主线程任务完成后;
- 从任务队列中顺序请求任务事件;
- 进入主线程执行;
- 不断反复以上步骤;

### 堵塞和非堵塞

##### 堵塞

```typescript
// 这是一个阻塞式函数, 将一个文件复制到另一个文件上, 假设耗时 1 分钟
// 1 分钟后才会返回结果
const copyBigFile = (src, dst) => {
  const result = copyFileSync(src, dst);
  return result;
};
console.log("start copying ... ");
copyBigFile("A.txt", "B.txt"); //这行程序将耗时1分钟
// 后续代码将在 1 分钟后才会执行
console.log("copy finished");
```

##### 非堵塞

```typescript
// 这是一个非阻塞式函数, 将一个文件复制到另一个文件上, 假设耗时 1 分钟
// 立刻返回结果
const copyBigFile = (src, dst) => {
  var result = copyFile(src, dst);
  return result;
};
console.log("start copying ... ");
copyBigFile("A.txt", "B.txt", () => {
  // 后续代码将在 1 分钟后才会执行
}); //这行程序将耗时1分钟
// 后续代码立刻执行
// 线程并没有堵塞, 可以进行其他操作
console.log("copy finished");
```

### 事件循环和任务队列

##### 事件循环

- js 创建一个循环, 每一次循环称作 tick;
- 每一次 tick 检查任务队列是否有待处理的事件;
- 即主线程反复从任务队列中请求事件并处理的过程;

##### 任务队列

- 任务队列又称消息队列;
- 异步任务完成 IO, DOM 等操作后;
- 便向任务队列中添加一个事件;

##### 事件循环的执行顺序

- 主线程代码执行完毕后才会执行事件循环;
- 若主线程中代码执行时间过长;
- 会堵塞事件循环的执行, 即异步任务的执行;

##### node 中的各种 sync 函数

- node 中的各种 sync 函数;
- 在主线程中执行;
- 因此会堵塞事件循环;
